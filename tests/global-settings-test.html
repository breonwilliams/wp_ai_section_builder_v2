<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Section Builder - Global Settings Test</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f7f7f7;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            border-bottom: 2px solid #e5e5e5;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #555;
            margin-top: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-item {
            padding: 15px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .test-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .test-value {
            font-family: monospace;
            font-size: 13px;
            color: #333;
            background: #f5f5f5;
            padding: 8px;
            border-radius: 3px;
            word-break: break-all;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }
        
        .color-preview {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 4px;
            margin-right: 10px;
            vertical-align: middle;
            border: 1px solid #ddd;
        }
        
        .ajax-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f0f6fc;
            border-radius: 6px;
        }
        
        button {
            padding: 8px 16px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #f5f5f5;
            border-color: #999;
        }
        
        button.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        button.primary:hover {
            background: #1d4ed8;
        }
        
        .console-output {
            background: #1a1a1a;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .validation-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        
        .validation-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .validation-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ§ª Global Settings Test Suite</h1>
        
        <!-- CSS Variables Check -->
        <div class="test-section">
            <h2>1. CSS Variables Injection Test</h2>
            <p>Check if global settings CSS variables are properly injected into the page:</p>
            
            <div class="test-grid" id="css-vars-test">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Color Preview -->
        <div class="test-section">
            <h2>2. Color Settings Preview</h2>
            <div class="test-grid" id="color-preview">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Typography Settings -->
        <div class="test-section">
            <h2>3. Typography Settings</h2>
            <div class="test-grid" id="typography-test">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Layout Settings -->
        <div class="test-section">
            <h2>4. Layout Settings</h2>
            <div class="test-grid" id="layout-test">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- AJAX Testing Controls -->
        <div class="ajax-controls">
            <h2>5. AJAX API Testing</h2>
            <p>Test the global settings AJAX endpoints:</p>
            
            <button onclick="testGetSettings()" class="primary">Get Current Settings</button>
            <button onclick="testSaveSettings()">Save Test Settings</button>
            <button onclick="testValidation()">Test Validation</button>
            <button onclick="testResetSettings()">Reset to Defaults</button>
            
            <div class="console-output" id="ajax-console">
                Ready for testing...
            </div>
        </div>
        
        <!-- Validation Testing -->
        <div class="test-section">
            <h2>6. Validation Rules Test</h2>
            <div id="validation-tests">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        // Test data for validation
        const testSettings = {
            colors: {
                primary: '#10b981',
                primary_hover: '#059669',
                text_heading: '#111827',
                text_body: '#4b5563',
                text_muted: '#9ca3af',
                bg_light: '#ffffff',
                bg_section: '#f9fafb',
                bg_dark: '#111827'
            },
            typography: {
                font_heading: 'Montserrat',
                font_body: 'Inter',
                size_base: 16,
                scale_ratio: 1.25,
                line_height_body: 1.6,
                line_height_heading: 1.2
            },
            layout: {
                container_width: 1200,
                section_padding: 80,
                element_spacing: 24,
                breakpoint_tablet: 768,
                breakpoint_mobile: 480
            }
        };
        
        // Invalid test data for validation testing
        const invalidSettings = {
            colors: {
                primary: 'not-a-color', // Invalid hex
                primary_hover: '#GG1234' // Invalid hex
            },
            typography: {
                size_base: 5, // Below minimum
                scale_ratio: 2.0 // Above maximum
            },
            layout: {
                container_width: 500, // Below minimum
                section_padding: 300 // Above maximum
            }
        };
        
        // Function to check CSS variables
        function checkCSSVariables() {
            const variables = [
                '--aisb-gs-primary',
                '--aisb-gs-primary-hover',
                '--aisb-gs-text-heading',
                '--aisb-gs-text-body',
                '--aisb-gs-text-muted',
                '--aisb-gs-bg-light',
                '--aisb-gs-bg-section',
                '--aisb-gs-bg-dark',
                '--aisb-gs-font-heading',
                '--aisb-gs-font-body',
                '--aisb-gs-size-base',
                '--aisb-gs-scale-ratio',
                '--aisb-gs-container-width',
                '--aisb-gs-section-padding',
                '--aisb-gs-element-spacing'
            ];
            
            const container = document.getElementById('css-vars-test');
            const computedStyle = getComputedStyle(document.documentElement);
            
            variables.forEach(varName => {
                const value = computedStyle.getPropertyValue(varName);
                const status = value ? 'success' : 'error';
                
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `
                    <label>
                        <span class="status-indicator status-${status}"></span>
                        ${varName}
                    </label>
                    <div class="test-value">${value || 'NOT DEFINED'}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // Function to preview colors
        function previewColors() {
            const colors = [
                { var: '--aisb-gs-primary', label: 'Primary' },
                { var: '--aisb-gs-primary-hover', label: 'Primary Hover' },
                { var: '--aisb-gs-text-heading', label: 'Heading Text' },
                { var: '--aisb-gs-text-body', label: 'Body Text' },
                { var: '--aisb-gs-text-muted', label: 'Muted Text' },
                { var: '--aisb-gs-bg-light', label: 'Light Background' },
                { var: '--aisb-gs-bg-section', label: 'Section Background' },
                { var: '--aisb-gs-bg-dark', label: 'Dark Background' }
            ];
            
            const container = document.getElementById('color-preview');
            const computedStyle = getComputedStyle(document.documentElement);
            
            colors.forEach(color => {
                const value = computedStyle.getPropertyValue(color.var) || '#ccc';
                
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `
                    <label>${color.label}</label>
                    <div style="display: flex; align-items: center;">
                        <span class="color-preview" style="background: ${value}"></span>
                        <span class="test-value">${value}</span>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // Function to check typography settings
        function checkTypography() {
            const settings = [
                { var: '--aisb-gs-font-heading', label: 'Heading Font' },
                { var: '--aisb-gs-font-body', label: 'Body Font' },
                { var: '--aisb-gs-size-base', label: 'Base Size' },
                { var: '--aisb-gs-scale-ratio', label: 'Scale Ratio' },
                { var: '--aisb-gs-size-h1', label: 'H1 Size' },
                { var: '--aisb-gs-size-h2', label: 'H2 Size' },
                { var: '--aisb-gs-line-height-body', label: 'Body Line Height' },
                { var: '--aisb-gs-line-height-heading', label: 'Heading Line Height' }
            ];
            
            const container = document.getElementById('typography-test');
            const computedStyle = getComputedStyle(document.documentElement);
            
            settings.forEach(setting => {
                const value = computedStyle.getPropertyValue(setting.var);
                
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `
                    <label>${setting.label}</label>
                    <div class="test-value">${value || 'NOT SET'}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // Function to check layout settings
        function checkLayout() {
            const settings = [
                { var: '--aisb-gs-container-width', label: 'Container Width' },
                { var: '--aisb-gs-section-padding', label: 'Section Padding' },
                { var: '--aisb-gs-element-spacing', label: 'Element Spacing' },
                { var: '--aisb-gs-breakpoint-tablet', label: 'Tablet Breakpoint' },
                { var: '--aisb-gs-breakpoint-mobile', label: 'Mobile Breakpoint' }
            ];
            
            const container = document.getElementById('layout-test');
            const computedStyle = getComputedStyle(document.documentElement);
            
            settings.forEach(setting => {
                const value = computedStyle.getPropertyValue(setting.var);
                
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `
                    <label>${setting.label}</label>
                    <div class="test-value">${value || 'NOT SET'}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // Console logging helper
        function logToConsole(message, type = 'info') {
            const console = document.getElementById('ajax-console');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44' : type === 'success' ? '#4f4' : '#fff';
            
            console.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }
        
        // AJAX test functions (simulated - replace with actual AJAX calls in WordPress)
        function testGetSettings() {
            logToConsole('Testing GET settings endpoint...');
            
            // Simulate API call
            setTimeout(() => {
                logToConsole('âœ“ Settings retrieved successfully', 'success');
                logToConsole(JSON.stringify(testSettings, null, 2));
            }, 500);
        }
        
        function testSaveSettings() {
            logToConsole('Testing SAVE settings endpoint...');
            logToConsole('Sending test settings...');
            
            // Simulate API call
            setTimeout(() => {
                logToConsole('âœ“ Settings saved successfully', 'success');
            }, 1000);
        }
        
        function testValidation() {
            logToConsole('Testing validation rules...');
            
            const tests = [
                { field: 'colors.primary', value: '#123456', expected: 'valid' },
                { field: 'colors.primary', value: 'not-a-color', expected: 'invalid' },
                { field: 'typography.size_base', value: 16, expected: 'valid' },
                { field: 'typography.size_base', value: 5, expected: 'invalid (below min)' },
                { field: 'layout.container_width', value: 1200, expected: 'valid' },
                { field: 'layout.container_width', value: 2000, expected: 'invalid (above max)' }
            ];
            
            tests.forEach(test => {
                const status = test.expected.includes('invalid') ? 'âœ—' : 'âœ“';
                const color = test.expected.includes('invalid') ? 'error' : 'success';
                logToConsole(`${status} ${test.field} = ${test.value} â†’ ${test.expected}`, color);
            });
        }
        
        function testResetSettings() {
            logToConsole('Testing RESET settings endpoint...');
            
            // Simulate API call
            setTimeout(() => {
                logToConsole('âœ“ Settings reset to defaults', 'success');
            }, 500);
        }
        
        // Run validation tests
        function runValidationTests() {
            const container = document.getElementById('validation-tests');
            
            const tests = [
                {
                    name: 'Valid Color Format',
                    test: () => /^#[0-9A-Fa-f]{6}$/.test('#2563eb'),
                    expected: true
                },
                {
                    name: 'Invalid Color Format',
                    test: () => /^#[0-9A-Fa-f]{6}$/.test('rgb(255,0,0)'),
                    expected: false
                },
                {
                    name: 'Font Size Range (12-20)',
                    test: () => {
                        const size = 16;
                        return size >= 12 && size <= 20;
                    },
                    expected: true
                },
                {
                    name: 'Container Width Range (960-1920)',
                    test: () => {
                        const width = 1200;
                        return width >= 960 && width <= 1920;
                    },
                    expected: true
                }
            ];
            
            tests.forEach(test => {
                const result = test.test();
                const passed = result === test.expected;
                
                const div = document.createElement('div');
                div.className = `validation-result validation-${passed ? 'success' : 'error'}`;
                div.innerHTML = `
                    <strong>${test.name}:</strong> 
                    ${passed ? 'âœ“ PASSED' : 'âœ— FAILED'}
                    (Expected: ${test.expected}, Got: ${result})
                `;
                container.appendChild(div);
            });
        }
        
        // Initialize all tests on page load
        window.addEventListener('load', () => {
            checkCSSVariables();
            previewColors();
            checkTypography();
            checkLayout();
            runValidationTests();
            
            // Check if we're in WordPress context
            if (typeof wp !== 'undefined') {
                logToConsole('âœ“ WordPress context detected', 'success');
            } else {
                logToConsole('âš  Running in standalone mode (not in WordPress)', 'warning');
            }
        });
    </script>
</body>
</html>